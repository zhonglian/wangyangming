// 定义一个根对象，用来存储配置项
var root = {
  wavecolor: {  
    r: 125,   // 红色通道的值
    g: 52,    // 绿色通道的值
    b: 253    // 蓝色通道的值
  },
  rainbowSpeed: 0.5,  // 彩虹效果的速度
  rainbow: false,      // 是否启用彩虹效果
  matrixspeed: 200     // 字符雨的速度
};

// 获取 canvas 元素，并获取绘图上下文
var c = document.getElementById("c");
var ctx = c.getContext("2d");

// 初始化一些变量
var hueFw = true;    // 用于控制彩虹颜色方向，false 表示递减，true 表示递增
var hue = -0.01;      // 初始色调值

// 将 canvas 设置为全屏
c.height = window.innerHeight;
c.width = window.innerWidth;

// 设置字体大小
var font_size = 14;
// 计算字符雨的列数
var columns = c.width / font_size;
// 创建一个渐变颜色，设置从 (0, 10) 到 (0, 200) 的线性渐变
var gradient = ctx.createLinearGradient(0, 10, 0, 200);

// 存储每列雨滴的初始位置（y 坐标）
var drops = [];
// 初始化每列的雨滴位置，开始时都在 y=1 位置
for (var x = 0; x < columns; x++)
  drops[x] = 1;

// 绘制字符雨
function draw() {
  // 设置背景颜色为半透明黑色，用于显示字符的轨迹
  ctx.fillStyle = "rgba(0,0,0, 0.05)";
  ctx.fillRect(0, 0, c.width, c.height);  // 填充整个画布

  ctx.fillStyle = "#BBB";  // 设置字符的默认颜色为灰色
  ctx.font = font_size + "px arial";  // 设置字体样式

  // 遍历每一列的雨滴，绘制字符
  for (var i = 0; i < drops.length; i++) {
    // 设置每列的背景颜色为不透明黑色
    ctx.fillStyle = "rgba(10,10,10, 1)";
    ctx.fillRect(i * font_size, drops[i] * font_size, font_size, font_size); // 绘制每列的字符背景


	var st = characters[i % characters.length ].length;
    // 随机选择一个字符进行显示
	var text = characters[i % characters.length ][drops[i] % characters[i % characters.length ].length];

    // 判断是否启用了彩虹效果
    if (root.rainbow) {
      hue += (hueFw) ? 0.01 : -0.01;  // 根据 hueFw 的值，调整色调的递增或递减
      // 计算 RGB 色值，基于当前的 hue 值生成彩虹效果
      var rr = Math.floor(127 * Math.sin(root.rainbowSpeed * hue + 0) + 128);
      var rg = Math.floor(127 * Math.sin(root.rainbowSpeed * hue + 2) + 128);
      var rb = Math.floor(127 * Math.sin(root.rainbowSpeed * hue + 4) + 128);
      ctx.fillStyle = 'rgba(' + rr + ',' + rg + ',' + rb + ')'; // 设置字符颜色为 RGB 彩虹色
    } else {
      // 如果没有启用彩虹效果，则使用固定的 wavecolor 颜色
      ctx.fillStyle = 'rgba(' + root.wavecolor.r + ',' + root.wavecolor.g + ',' + root.wavecolor.b + ')';
    }

    // 绘制字符到画布上
    ctx.fillText(text, i * font_size, drops[i] * font_size);
    
    // 增加 Y 坐标，使得字符向下移动
    drops[i]++;
    
    // 当字符下落超过画布底部时，重新将字符位置设为顶部
    // 使用随机性使得字符在 Y 轴上有随机性
    if (drops[i] * font_size > c.height && Math.random() > 0.975)
      drops[i] = 0;
  }
}

// 当窗口大小变化时，重新加载页面
window.onresize = () => {
  location.reload();
}


// 定时器，按照设置的速度绘制字符雨
setInterval(draw, root.matrixspeed);

// 用于接收外部的属性变更（例如通过界面控制颜色、速度等）
function livelyPropertyListener(name, val) {
  switch(name) {
    case "matrixColor":  // 修改颜色
      root.wavecolor = hexToRgb(val);  // 将十六进制颜色转换为 RGB
      break;
    case "rainBow":  // 启用或禁用彩虹效果
      root.rainbow = val;
      break;   
    case "rainbowSpeed":  // 修改彩虹速度
      root.rainbowSpeed = val / 100;  // 将输入值除以100，调整速度
      break;     
  }
}

// 十六进制颜色转 RGB 格式
function hexToRgb(hex) {
  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),  // 红色
    g: parseInt(result[2], 16),  // 绿色
    b: parseInt(result[3], 16)   // 蓝色
  } : null;
}





// 直接在代码中嵌入金刚经的内容
var characters = [
	"眼前路径须放开阔，才好容人来往，若太拘窄，恐自己亦无展足之地矣",
	"体，即良知之体，用，即良知之用，宁复有超然于体用之外者乎？",
	"山近月远觉月小，便道此山大于月。若人有眼大如天，当见山高月更阔",
	"人若知这良知诀窍，随他多少邪思枉念，这里一觉，都自消融",
	"千罪百恶，皆从傲上来。只是一 “傲” 字，便结果了这一生",
	"志不立，如无舵之舟，无衔之马，漂荡奔逸，终亦何所底乎",
	"持志如心痛，一心在痛上，岂有功夫说闲话，管闲事",
	"学者学圣人，不过是去人欲而存天理耳，犹炼金而求其足色",
	"以言语谤人，其谤浅；是以身谤也，其谤深矣",
	"思是良知之发用。若是良知发用之思，则所思莫非天理矣",
	"知之真切笃实处即是行，行之明觉精察处即是知",
	"见贤思齐焉，见不贤而内自省，则不至于责人已甚，而自治严矣",
	"良知之外，别无知矣；故 “致良知” 是圣人教人第一义",
	"与愚夫愚妇同的，是谓同德；与愚夫愚妇异的，是谓异端",
	"你萌时这一知处，便是你的命根；当下即去消磨，便是立命功夫",
	"人胸中各有个圣人，只自信不及，都自埋倒了",
	"故立志者，为学之心也；为学者，立志之事也",
	"学须反己。若徒责人，只见得人不是，不见自己非",
	"你看满大街都是圣人，满大街的人看你也是圣人",
	"学是学去人欲，存天理。从事于去人欲存天理，则自正",
	"圣人无所不知，只是知个天理；无所不能，只是能个天理",
	"人心本是天然之理，精精明明，无纤介染着，只是一无我而已",
	"凡谋其力之所不及而强其知之所不能者，皆不得为致良知",
	"不欺则良知无所伪而诚，诚则明矣；自信则良知无所惑而明，明则诚矣",
	"天地虽大，但有一念向善，心存良知，虽凡夫俗子，皆可为圣贤",
	"以事言谓之史，以道言谓之经；事即道，道即事；春秋亦经，五经亦史",
	"身之主宰便是心，心之所发便是意，意之本体便是知，意之所在便是物",
	"知行合一：知之真切笃实处即是行，行之明觉精察处即是知",
	"然可欲者是我的物，不可放失；不可欲者非是我物，不可留藏",
	"个个人心有仲尼，自将闻见苦遮迷。而今指与真头面，只是良知更莫疑",
	"有心俱是实，无心俱是幻；无心俱是实，有心俱是幻",
	"上智下愚，如何不可移？不是不可移，只是不肯移",
	"殃莫大于叨天之功，罪莫大于掩人之善，恶莫深于袭下之能，辱莫重于忘己之耻，四者备而祸全",
	"只怕镜不明，不怕物来不能照。讲求事变，亦是照时事，然学者却须先有个明的工夫。学者惟患此心之未能明，不患事变之不能尽",
	"于事事物物上求至善，却是义外也。至善是心之本体，只是‘明明德’到至精至一处便是，然亦未尝离却事物",
	"‘尽心知性知天’是‘生知安行’事，‘存心养性事天’是‘学知利行’事，‘夭寿不贰，修身以俟’是‘困知勉行’事",
	"夫万事万物之理不外于吾心",
	"方丈地内，种此一大树，雨露之滋，土脉之力，只滋养得这个大根。四傍纵要种些嘉谷，上面被此树树叶遮覆，下面被此树根盘结，如何生长得成？须用伐去此树，纤根勿留，方可种植嘉谷。不然，任汝耕耘培壅，只是滋养得此根",
	"只念念要存天理，即是立志。能不忘乎此，久则自然心中凝聚，犹道家所谓‘结圣胎’也。此天理之念常存，驯至于美大圣神，亦只从此一念存养扩充去耳",
	"知而不行只是未知。圣贤教人知行，正是要复那本体。不是着你只恁的便罢。故《大学》指个真知行与人看，说‘如好好色’，‘如恶恶臭’。见好色属知，好好色属行。只见那好色时已自好了，不是见了后又立个心去好，闻恶臭属知，恶恶臭属行。只闻那恶臭时已自恶了，不是闻了后别立个心去恶。如鼻塞人虽见恶臭在前，鼻中不曾闻得，便亦不甚恶。亦只是不曾知臭。就如称某人知孝、某人知弟，必是其人已曾行孝行弟。又如知痛，必已自痛了，方知痛。知寒，必已自寒了。知饥，必已自饥了。知行如何分得开？此便是知行的本体，不曾有私意隔断的。圣人教人，必要是如此，方可谓之知。不然，只是不曾知。此却是何等紧切着实的功夫！如今苦苦定要说知行做两个，是甚么意？某要说做一个，是甚么意？若不知立言宗旨，只管说一个两个，亦有甚用？”",
	"义理无定在，无穷尽。吾与子言，不可以少有所得，而遂谓止此也。再言之十年、二十年、五十年，未有止也。“他日又曰：” 圣如尧、舜，在尧、舜之上善无尽；恶如桀、纣，然桀、纣之下恶无尽。使桀、纣未死，恶字止此乎？使善有尽时，文王何以‘望道而未之见’？",
	"只不善看，亦便有病痛",
	"圣人之心如明镜，只是一个明，则随感而应，无说不照。未有已往之形尚在，未照之形先具者。若后世所讲，欲是如此，是以与圣人之学大背",
	"心即理也。心外无理，心外无物，心外无事",
	"性是心之体，天是性之原。尽心即是尽性",
	"笃信固亦是，然不如反求之切。今既不得于心，安可狃于旧闻，不求是当？",
	"好色则一心在好色上，好货则一心在好货上，可以为主一乎？是所谓逐物，非主一也。主一是专主一个天理问立志",
	"夫学贵得之于心。求之于心而非也，虽其言之出于孔子，不敢以为是也，而况其未及孔子者乎？求之于心而是也，虽其言出于庸常，不敢以为非也，而况其出于孔子者乎？",
	"人心之得其正者即道心；道心之失其正者即人心",
	"穷通夭寿有个命在，我亦不必以此动心",
	"无善无恶心之体，有善有恶意之动，知善知恶是良知，为善去恶是格物",
	"你未看此花时，此花与汝心同归于寂。你来看此花时，则此花颜色一时明白起来。便知此花不在你的心外",
	"譬之树木，这诚孝的心便是根，许多条件便是枝叶。须先有根，然后有枝叶。不是先寻了枝叶，然后去种根",
	"心即理也，此心无私欲之蔽，即是天里，不须外面添一份。以此存乎天理之心，发之事父便是孝，发之事君便是忠，发之交友、治民便是信与仁。只是此心去人欲、存天理上用功便是",
	"有志于圣人之学者，外孔、孟之训而他求，（经典语录）是舍日月之明，而希光于萤爝之微也，不亦谬乎？",
	"所以为圣者，在纯乎天理，而不在才力也。故虽凡人，而肯为学，使此心纯乎天理，则亦可为圣人",
	"处朋友，务相下则得益，相上则损",
	"破山中贼易，破心中贼难",
	"圣人与天地民物同体，儒、佛、老、庄皆我之用，是之谓大道。二氏自私其身，是之谓小道",
	"非有学问思辨之功，将不免于毫厘千里之缪。所以虽在圣人，犹如‘精一’之训。若只是那些仪节求得是当，便谓至善，即如今扮戏子扮得许多温情奉养的仪节是当，亦可谓之至善矣。” 爱于是日又有省",
	"人心天理浑然。圣贤笔之书，如写真传神，不过示人以形状大略，使之因此而讨求其真耳。其精神意气，言笑动止，固有所不能传也。后世着述，是又将圣人所画摹仿誊写，而妄自分析加增以逞其技，其失真愈远矣",
	"日间工夫觉纷扰，则静坐。觉懒看书，则且看书。是亦因病而药",
	"夫学贵得之于心。求之于心而非也，虽其言之出于孔子，不敢以为是也，而况其未及孔子者乎？求之于心而是也，虽其言出于庸常，不敢以为非也，而况其出于孔子者乎？",
	"此心光明，亦复何言，人性之善，天下无不可化之人",
	"人须事上磨练做功夫，乃有益。若只好静，遇事便乱，终无长进。那静时功夫亦差，似收敛而实放溺也",
	"立志用功，如种树然。方其根芽，犹未有干。及其有干，尚未有枝。枝而后叶。叶而后花实。初种根时，只管栽培灌溉。勿作枝想。勿作叶想。勿作花想。勿作实想。悬想何益？但不忘栽培之功，怕。没有枝叶花寅",
	"攻吾之短者是吾师",
	"立学、立言之着，立德、立身之典",
	"克己须扫除廓清，一毫不存方是有一毫在，则众恶相引而来",
	"圣人必可学而至",
	"处朋友，务相下则得，相上则损",
	"致知必在于行，而不行之不可以为致知也",
	"私欲日生，如地上尘，一日不扫，更又一层",
	"心之良知是谓圣人，圣人之学，惟是致良知",
	"千圣皆过影，良知乃吾师",
	"知善知恶是良知",
	"能戒慎恐惧者，是良知也",
	"性无不善，故知无不良",
	"博学只是事事存此天理，笃行只是学之不已之意",
	"知行本体，即是良知",
	"知之真切笃实处，即是行，行之明觉精察处，即是知",
	"知是行之始，行是知之成",
	"未有知而不行者，知而不行是未知",
	"此心无私欲之弊，即是天理",
	"心外无物，如吾心发一念孝亲，即孝亲便是物",
	"心即道，道即天，知心则知道",
	"学为圣人之道，学以致良知",
	"切勿得失横在胸中",
	"知圣人之道，吾性自足，向之求理于事物者，误也",
	"人生大病，只是一 “傲” 字",
	"故立志者，为学之心也；为学者，立志之事也",
	"有志于圣人之学者，外孔、孟之训而他求，是舍日月之明，而希光于萤爝之微也，不亦谬乎？",
	"人心之得其正者即道心；道心之失其正者即人心",
	"君子之交，其淡如水，执象而求，咫尺千里",
	"反观自身，自我提升",
	"求道须深下去",
	"只求力所能及",
	"耐住寂寞，久久为功",
	"若己为君子，而使人为小人，亦非仁人忠恕恻怛之心",
	"何为第一等事？当读书做圣人耳"
];